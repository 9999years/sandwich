<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/sandwich/blog/rss.xml" title="Sandwich Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/sandwich/blog/atom.xml" title="Sandwich Blog Atom Feed"><title data-react-helmet="true">Selenium integration | Sandwich</title><meta data-react-helmet="true" property="og:url" content="https://github.com/codedownio/sandwich/sandwich/docs/extensions/sandwich-webdriver"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Selenium integration | Sandwich"><meta data-react-helmet="true" name="description" content="Setting up Selenium tests normally requires manual work to obtain the Selenium server JAR file and a driver program for your browser, launch the server, and connect to the server with your client library. It can be error-prone to make sure the versions are compatible and everything runs smoothly."><meta data-react-helmet="true" property="og:description" content="Setting up Selenium tests normally requires manual work to obtain the Selenium server JAR file and a driver program for your browser, launch the server, and connect to the server with your client library. It can be error-prone to make sure the versions are compatible and everything runs smoothly."><link data-react-helmet="true" rel="shortcut icon" href="/sandwich/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://github.com/codedownio/sandwich/sandwich/docs/extensions/sandwich-webdriver"><link data-react-helmet="true" rel="alternate" href="https://github.com/codedownio/sandwich/sandwich/docs/extensions/sandwich-webdriver" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://github.com/codedownio/sandwich/sandwich/docs/extensions/sandwich-webdriver" hreflang="x-default"><link rel="stylesheet" href="/sandwich/assets/css/styles.e8e3ffbf.css">
<link rel="preload" href="/sandwich/assets/js/styles.f730fd94.js" as="script">
<link rel="preload" href="/sandwich/assets/js/runtime~main.7a8d87a9.js" as="script">
<link rel="preload" href="/sandwich/assets/js/main.aed8eef3.js" as="script">
<link rel="preload" href="/sandwich/assets/js/1.bce80bcf.js" as="script">
<link rel="preload" href="/sandwich/assets/js/2.3ea8622d.js" as="script">
<link rel="preload" href="/sandwich/assets/js/32.3be111e4.js" as="script">
<link rel="preload" href="/sandwich/assets/js/33.fba81c35.js" as="script">
<link rel="preload" href="/sandwich/assets/js/935f2afb.7b07ba41.js" as="script">
<link rel="preload" href="/sandwich/assets/js/17896441.064667ba.js" as="script">
<link rel="preload" href="/sandwich/assets/js/b6697e7b.9c278475.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/sandwich/"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Sandwich</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/sandwich/docs/">Docs</a><a class="navbar__item navbar__link" href="/sandwich/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/sandwich/"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/sandwich/img/logo.svg" alt="Sandwich" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Sandwich</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/sandwich/docs/">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/sandwich/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Basics</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/contexts">Contexts</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/node_options">Node Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/timing">Timing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/command_line">Command line</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/discovery">Test Discovery</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Formatters</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/tui">Terminal UI Formatter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/print">Print Formatter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/failure_report">Failure Report Formatter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/log_saver">Log Saver Formatter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/silent">Silent Formatter</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/sandwich/docs/formatters/slack">Slack Formatter</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/sandwich/docs/extensions/sandwich-webdriver">Selenium integration</a></li><li class="menu__list-item"><a class="menu__link" href="/sandwich/docs/extensions/sandwich-quickcheck">QuickCheck integration</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Selenium integration</h1></header><div class="markdown"><p>Setting up Selenium tests normally requires manual work to obtain the Selenium server JAR file and a driver program for your browser, launch the server, and connect to the server with your client library. It can be error-prone to make sure the versions are compatible and everything runs smoothly.</p><p>The <code>sandwich-webdriver</code> extension streamlines this by automatically downloading the latest compatible binary files and introducing the contexts you need to use the <a href="https://hackage.haskell.org/package/webdriver" target="_blank" rel="noopener noreferrer">webdriver</a> package within Sandwich. Here&#x27;s how easy it is to get started:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">import Test.Sandwich</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import Test.Sandwich.WebDriver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">import Test.WebDriver</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec :: TopSpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec = introduceWebDriver (defaultWdOptions &quot;/tmp/tools&quot;) $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  it &quot;opens Google and searches&quot; $ withSession1 $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    openPage &quot;http://www.google.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    search &lt;- findElem (ByCSS &quot;input[title=&#x27;Search&#x27;]&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    click search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    sendKeys &quot;asdf\n&quot; search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">main :: IO ()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">main = runSandwich defaultOptions spec</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To see a demo, try running <code>stack run demo-webdriver</code> in the Sandwich repo.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="browser-sessions"></a>Browser sessions<a class="hash-link" href="#browser-sessions" title="Direct link to heading">#</a></h2><p>You can start a Selenium session using the <code>withSession</code> function. It accepts a string key representing the name of the session. Each time a new session name is seen, it will be created if it doesn&#x27;t already exist.</p><p>The library provides <code>withSession1</code>/<code>withSession2</code> as convenience functions for <code>withSession &quot;browser1&quot;</code>/<code>withSession &quot;browser2&quot;</code>, but you can use your own keys if you need.</p><p>For example, the code below opens two windows with a different site in each.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec :: TopSpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">spec = introduceWebDriver (defaultWdOptions &quot;/tmp/tools&quot;) $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  describe &quot;two browser sessions&quot; $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;opens Google&quot; $ withSession1 $ openPage &quot;http://www.google.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;opens Yahoo&quot; $ withSession2 $ openPage &quot;http://www.yahoo.com&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="window-positioning"></a>Window positioning<a class="hash-link" href="#window-positioning" title="Direct link to heading">#</a></h2><p>You can use the functions in <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver-Windows.html" target="_blank" rel="noopener noreferrer">Test.Sandwich.WebDriver.Windows</a> to arrange browser windows on the screen. This is useful when you want to watch two browsers simultaneously accessing a collaborative app.</p><p>The code below extends the previous example with window positioning. You can find this in the <code>webdriver-positioning</code> demo.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">positioning :: TopSpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">positioning = introduceWebDriver (defaultWdOptions &quot;/tmp/tools&quot;) $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  describe &quot;two windows side by side&quot; $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;opens Google&quot; $ withSession1 $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      openPage &quot;http://www.google.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      setWindowLeftSide</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;opens Google&quot; $ withSession2 $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      openPage &quot;http://www.yahoo.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      setWindowRightSide</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="launching-browsers-in-the-background"></a>Launching browsers in the background<a class="hash-link" href="#launching-browsers-in-the-background" title="Direct link to heading">#</a></h2><p>This package makes it easy to run Selenium tests in the background, using either <a href="https://en.wikipedia.org/wiki/Xvfb" target="_blank" rel="noopener noreferrer">Xvfb</a> or the headless mode of your browser.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="headless"></a>Headless<a class="hash-link" href="#headless" title="Direct link to heading">#</a></h3><p>Many browsers now have the ability to natively run in headless mode. For example, passing these modified <code>WdOptions</code> to <code>introduceWebDriver</code> will run using headless Firefox.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">wdOptions = (defaultWdOptions &quot;/tmp/tools&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  capabilities = firefoxCapabilities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  , runMode = RunHeadless defaultHeadlessConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Alternatively, if you use Sandwich&#x27;s <a href="http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:runSandwichWithCommandLineArgs" target="_blank" rel="noopener noreferrer">runSandwichWithCommandLineArgs</a> in conjunction with <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver.html#v:introduceWebDriverOptions" target="_blank" rel="noopener noreferrer">introduceWebDriverOptions</a>, you can enable headless mode by passing <code>--headless</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="xvfb"></a>Xvfb<a class="hash-link" href="#xvfb" title="Direct link to heading">#</a></h3><p>Xvfb can be used to run your browser on a separate, &quot;virtual&quot; X11 display, different from the one connected to your monitor. This was more useful before headless browser modes existed, but it&#x27;s still important because it gives you the ability to record <strong>video</strong>. When a Selenium test is running on an Xvfb display, you can use <a href="https://ffmpeg.org/" target="_blank" rel="noopener noreferrer">ffmpeg</a> to record videos of the test runs for later examination.</p><p>Xvfb mode can be configured manually just like headless mode.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">wdOptions = (defaultWdOptions &quot;/tmp/tools&quot;) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  capabilities = chromeCapabilities</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  , runMode = RunInXvfb XvfbConfig</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Or, if you use Sandwich&#x27;s <a href="http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:runSandwichWithCommandLineArgs" target="_blank" rel="noopener noreferrer">runSandwichWithCommandLineArgs</a> in conjunction with <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver.html#v:introduceWebDriverOptions" target="_blank" rel="noopener noreferrer">introduceWebDriverOptions</a>, you can enable Xvfb mode by passing <code>--xvfb</code>.</p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>Xvfb and ffmpeg must be installed in the test environment to use these features.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="recording-videos"></a>Recording videos<a class="hash-link" href="#recording-videos" title="Direct link to heading">#</a></h2><p>As discussed above, recording video doesn&#x27;t work in headless (<code>--headless</code>) mode. It requires normal (<code>--current</code>) or Xvfb (<code>--xvfb</code>) mode.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="manually"></a>Manually<a class="hash-link" href="#manually" title="Direct link to heading">#</a></h3><p>Using the methods in <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver-Video.html" target="_blank" rel="noopener noreferrer">Test.Sandwich.WebDriver.Video</a>, you can wrap arbitrary sections of a test in video recording. The example below can be found in the <code>webdriver-video</code> demo.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">manualVideo :: TopSpec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">manualVideo = introduceWebDriver (defaultWdOptions &quot;/tmp/tools&quot;) $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  describe &quot;video recording&quot; $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    it &quot;opens Google&quot; $ withSession1 $ do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      openPage &quot;http://www.google.com&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      Just dir &lt;- getCurrentFolder</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      let path = dir &lt;/&gt; &quot;video&quot; -- No extension needed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      bracket (startBrowserVideoRecording path defaultVideoSettings) endVideoRecording $ \_ -&gt; do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        search &lt;- findElem (ByCSS [i|input[title=&quot;Search&quot;]|])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        click search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        sendKeys &quot;Haskell Sandwich&quot; search</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        findElem (ByCSS [i|input[type=&quot;submit&quot;]|]) &gt;&gt;= click</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can also wrap video around multiple tests by using the <a href="http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:around" target="_blank" rel="noopener noreferrer">around</a> node, or around individual tests using <a href="http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:aroundEach" target="_blank" rel="noopener noreferrer">aroundEach</a>, etc.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="with-command-line-options"></a>With command line options<a class="hash-link" href="#with-command-line-options" title="Direct link to heading">#</a></h3><p>If you use Sandwich&#x27;s <a href="http://hackage.haskell.org/package/sandwich/docs/Test-Sandwich.html#v:runSandwichWithCommandLineArgs" target="_blank" rel="noopener noreferrer">runSandwichWithCommandLineArgs</a> in conjunction with <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver.html#v:introduceWebDriverOptions" target="_blank" rel="noopener noreferrer">introduceWebDriverOptions</a>, then you can take advantage of the built-in command line arguments <code>--individual-videos</code> and <code>--error-videos</code>. The former will record videos of every individual test and store them in the corresponding folder on disk. The latter will do the same, but will delete the videos if the test ran successfully, so you only end up with error videos.</p><p>You can try this out by running:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><div tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">stack run demo-webdriver -- --individual-videos</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="screenshots"></a>Screenshots<a class="hash-link" href="#screenshots" title="Direct link to heading">#</a></h2><p>Because every Sandwich test tree has an associated directory in the filesystem, it&#x27;s easy to capture screenshots during a test.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">Just dir &lt;- getCurrentFolder</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">screenshot &gt;&gt;= liftIO . BL.writeFile (dir &lt;/&gt; &quot;screenshot.png&quot;)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="custom-selenium-and-driver-binaries"></a>Custom Selenium and driver binaries<a class="hash-link" href="#custom-selenium-and-driver-binaries" title="Direct link to heading">#</a></h2><p>By default, the WebDriver machinery will obtain the Selenium JAR and driver binaries from the web automatically. However, you can also manually configure which ones are used by passing a disk path.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">data WdOptions = WdOptions {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  , seleniumToUse = UseSeleniumAt &quot;/path/to/selenium.jar&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  , chromeDriverToUse = UseChromeDriverAt &quot;/path/to/chromedriver&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  , geckoDriverToUse = UseGeckoDriverAt &quot;/path/to/geckodriver&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Alternatively, you can pass <a href="http://hackage.haskell.org/package/sandwich-webdriver/docs/Test-Sandwich-WebDriver-Config.html#t:SeleniumToUse" target="_blank" rel="noopener noreferrer">DownloadSeleniumFrom</a> with a URL to download, and similarly for the other options. Please see the Haddocks for more details.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="running-tests-in-parallel-with-a-webdriver-pool"></a>Running tests in parallel with a webdriver pool<a class="hash-link" href="#running-tests-in-parallel-with-a-webdriver-pool" title="Direct link to heading">#</a></h2><p>If you have a lot of test files, you probably want to run them in parallel so the test suite finishes faster. However, you probably don&#x27;t want to run them <strong>all</strong> in parallel, since running that many browser sessions could bog down your CI machine. A good solution is to use <a href="https://hackage.haskell.org/package/resource-pool" target="_blank" rel="noopener noreferrer">Data.Pool</a> to introduce a fixed-size pool of reusable WebDriver contexts.</p><p>You can follow along with this example in the <code>webdriver-pool</code> demo.</p><p>The first thing we need to do is come up with a label and introduce a pool of the desired size.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">webDriverPool = Label :: Label &quot;webDriverPool&quot; (Pool WebDriver)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">type HasWebDriverPool context = HasLabel context &quot;webDriverPool&quot; (Pool WebDriver)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">introduceWebDriverPool poolSize wdOptions&#x27; =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  introduce &quot;Introduce webdriver pool&quot; webDriverPool alloc cleanup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    alloc = do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wdOptions &lt;- addCommandLineOptionsToWdOptions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &lt;$&gt; (getCommandLineOptions @())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &lt;*&gt; pure wdOptions&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      runRoot &lt;- fromMaybe &quot;/tmp&quot; &lt;$&gt; getRunRoot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      liftIO $ createPool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (allocateWebDriver&#x27; runRoot wdOptions) cleanupWebDriver&#x27; 1 30 poolSize</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cleanup = liftIO . destroyAllResources</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>There&#x27;s some plumbing here because we want to pipe the command line options through. The important part is at the end, where we make a pool that knows how to allocate and deallocate WebDrivers using the lower-level <code>allocateWebDriver&#x27;</code> and <code>cleanupWebDriver&#x27;</code> functions.</p><p>Next, we make another introduce node to <em>claim</em> a WebDriver from the pool.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">claimWebdriver spec = introduceWith&#x27; (</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  defaultNodeOptions {nodeOptionsRecordTime=False, nodeOptionsCreateFolder=False}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  ) &quot;Claim webdriver&quot; webdriver wrappedAction spec</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  where</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    wrappedAction action = do</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      pool &lt;- getContext webDriverPool</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      withResource pool $ \sess -&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        (void $ action sess) `finally` closeAllSessions sess</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>There&#x27;s also some plumbing here where we tweak the node options of this to play better with <a href="/sandwich/docs/timing">test timing</a>. This code obtains the pool context, then claims a WebDriver to pass to its sub-nodes. It also cleans up at the end by calling <code>closeAllSessions</code>.</p><p>Having written these functions, we can finally write our tests. The following will run all the tests, up to four at a time, re-using the WebDrivers among them.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly haskell"><div tabindex="0" class="prism-code language-haskell codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">tests :: TopSpecWithOptions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tests =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  introduceWebDriverPool 4 (defaultWdOptions &quot;/tmp/tools&quot;) $</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    parallel $</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      replicateM_ 20 $</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        claimWebdriver $</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          it &quot;opens Google&quot; $ withSession1 $</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            openPage &quot;http://www.google.com&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Of course, in real use you probably want to introduce different tests to run in parallel. You can use <a href="/sandwich/docs/discovery">Test Discovery</a> to automatically generate them.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/extensions/sandwich-webdriver.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/sandwich/docs/formatters/slack"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Slack Formatter</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/sandwich/docs/extensions/sandwich-quickcheck"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">QuickCheck integration Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#browser-sessions" class="table-of-contents__link">Browser sessions</a></li><li><a href="#window-positioning" class="table-of-contents__link">Window positioning</a></li><li><a href="#launching-browsers-in-the-background" class="table-of-contents__link">Launching browsers in the background</a><ul><li><a href="#headless" class="table-of-contents__link">Headless</a></li><li><a href="#xvfb" class="table-of-contents__link">Xvfb</a></li></ul></li><li><a href="#recording-videos" class="table-of-contents__link">Recording videos</a><ul><li><a href="#manually" class="table-of-contents__link">Manually</a></li><li><a href="#with-command-line-options" class="table-of-contents__link">With command line options</a></li></ul></li><li><a href="#screenshots" class="table-of-contents__link">Screenshots</a></li><li><a href="#custom-selenium-and-driver-binaries" class="table-of-contents__link">Custom Selenium and driver binaries</a></li><li><a href="#running-tests-in-parallel-with-a-webdriver-pool" class="table-of-contents__link">Running tests in parallel with a webdriver pool</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/formatters/slack">Slack integration</a></li><li class="footer__item"><a class="footer__link-item" href="/sandwich/docs/extensions/sandwich-webdriver">Selenium integration</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/codedownio/sandwich/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/sandwich/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/codedownio/sandwich" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 Tom McLaughlin. Built with Docusaurus.</div></div></div></footer></div>
<script src="/sandwich/assets/js/styles.f730fd94.js"></script>
<script src="/sandwich/assets/js/runtime~main.7a8d87a9.js"></script>
<script src="/sandwich/assets/js/main.aed8eef3.js"></script>
<script src="/sandwich/assets/js/1.bce80bcf.js"></script>
<script src="/sandwich/assets/js/2.3ea8622d.js"></script>
<script src="/sandwich/assets/js/32.3be111e4.js"></script>
<script src="/sandwich/assets/js/33.fba81c35.js"></script>
<script src="/sandwich/assets/js/935f2afb.7b07ba41.js"></script>
<script src="/sandwich/assets/js/17896441.064667ba.js"></script>
<script src="/sandwich/assets/js/b6697e7b.9c278475.js"></script>
</body>
</html>